<!DOCTYPE html>
<html>
<head><title>Container</title><meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="container.css">
</head>
<body onload="initDivAndLogger()">
<div class="table">
 <div class="tr">
  <span>Label</span><input id="txtLabel" type="text" onchange="onInputValueChange(this.id)" value="Free text">
  <span>Category</span><div class="td" id="dvCateg"><!-- dynamic populated SELECT s10 here --></div>
 </div>
 <div class="tr" >
  <label for="vLevel">Level</label><input id="vLevel" type="number" style="max-width: 4em" oninput="onInputValueChange(this.id)" value="2">	
  <label for="vDelta">Delta</label><input id="vDelta" type="number" style="max-width: 6em" oninput="onInputValueChange(this.id)">	
 </div>
 <div class="tr">
  <span>Event Date</span><input id="dtEvent" type="date" onchange="onInputValueChange(this.id)" value="2021-05-21">
  <span>Date 2</span><input id="dt2" type="date" onchange="onInputValueChange(this.id)">
 </div>
 <div class="tr">
	<a href="#" onClick="MyWindow=window.open('popup.html?divId=hidenD1','MyWindow','width=800,height=300'); return false;">Click Here</a>
 </div>
</div>
<p><textarea id="msg" rows="8" cols="75"></textarea></p>
<div id="hidenD1" class="hidden-for-win">
	<table class="grid">
		<tbody id="idGrid"><!-- insert here --></tbody>
	</table>	  
</div>
<script src="trigger.js"></script>
<script src="datagrid.js"></script>
<script>
var logger;

var dfnCateg = {
	ND: "No Delta",
	FIX: "Fixed Delta",
	DR: "Delta Range"
};

function onInputValueChange(id) {
	applyConstraints(id);
}

function initDivAndLogger()
{
	function selectBox(vEltId) {
		let selectList = document.createElement("select");
		for (const [key, value] of Object.entries(dfnCateg)) {
			let option = document.createElement("option");
			option.value = key;
			option.text = value;
			selectList.appendChild(option);
		}	
		selectList.id = vEltId;
		return selectList;	
	}

	function addDropDown(prop) {
		const handler = () => {
			onInputValueChange(selectList.id, selectList.value);
		};
		let selectList = selectBox(prop.eltId);
		selectList.addEventListener("change", handler, false);

		let divCateg = document.getElementById("dvCateg");
		if (divCateg) {
			divCateg.appendChild(selectList);
		}
		selectList.value = prop.val;
	}
	
	addDropDown({eltId: 's10', val: 'ND'});	// s10 - categ

	let tbody = document.getElementById('idGrid');
	insertTBodyRow(tbody);

	// logger
	let txtMsg = document.getElementById("msg");	// TextArea	
	logger = (msg) => {txtMsg.value += msg + '\r\n'};
}

function applyConstraints(id0)
{
	document.getElementById("msg").value = '';	// Logger TextArea	

	let ctxtValues = {};
	let elts = document.getElementsByTagName('input');
	for (let e of elts) {
		ctxtValues[e.id] = e.value;
	}
	elts = document.getElementsByTagName('select');
	for (let e of elts) {
		ctxtValues[e.id] = e.value;
	}
	
	// trigger(id0, propValues, logger);		// include trigger.js
	trigger(ctxtValues, logger);
}
</script>
</body>
</html>