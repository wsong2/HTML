<!DOCTYPE html>
<html>
<head><title>Container</title><meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="container.css">
</head>
<body onload="initDivAndLogger()">
<div class="table">
 <form id="form1" action="javascript:void(0)">
 <div class="tr">
  <span>Label</span><input name="txtLabel" type="text" onchange="onInputValueChange(this.form, this.name)" value="Free text">
  <span>Category</span><div class="td" id="dvCateg"><!-- dynamic populated SELECT s10 here --></div>
 </div>
 <div class="tr" >
  <label for="idLevel">Level</label><input id="idLevel" name="vLevel" type="number" style="max-width: 4em" oninput="onInputValueChange(this.form, this.name)" value="2">	
  <label for="idDelta">Delta</label><input id="idDelta" name="vDelta" type="number" style="max-width: 6em" oninput="onInputValueChange(this.form, this.name)">	
 </div>
 <div class="tr">
  <span>Event Date</span><input name="dtEvent" type="date" onchange="onInputValueChange(this.form, this.name)" value="2021-05-21">
  <span>Date 2</span><input name="dt2" type="date" onchange="onInputValueChange(this.form, this.name)">
 </div>
 <div class="tr">
	<a href="#" onClick="MyWindow=window.open('popup.html?divId=hidenD1','MyWindow','width=800,height=300'); return false;">Show Grid</a>
 </div>
 <p><input type="reset"></p>
 </form>
</div>
<textarea id="msg" rows="8" cols="75"></textarea>
<div id="hidenD1" class="hidden-for-win">
	<table class="grid">
		<tbody id="idGrid"><!-- insert here --></tbody>
	</table>	  
</div>
<script src="trigger.js"></script>
<script src="datagrid.js"></script>
<script>
var logger;

function onInputValueChange(form, inputName) {
	//console.log('> ' + inputName);
	applyConstraints(form, inputName);
}

function initDivAndLogger()
{
	let dfnCateg = {
		ND: "No Delta",
		FIX: "Fixed Delta",
		DR: "Delta Range"
	};

	function selectBox(eltName)
	{
		let form1 = document.getElementById("form1");
		let selectList = document.createElement("select");
		for (const [key, value] of Object.entries(dfnCateg)) {
			let option = document.createElement("option");
			option.value = key;
			option.text = value;
			selectList.appendChild(option);
		}	
		selectList.name = eltName;
		selectList.addEventListener("change", 
			() => onInputValueChange(form1, selectList.name), 
			false);
		form1.appendChild(selectList);
		return selectList;	
	}

	function addDropDown(eltName, eltValue) {
		let selectList = selectBox(eltName);
		let divCateg = document.getElementById("dvCateg");
		if (divCateg) {
			divCateg.appendChild(selectList);
		}
		selectList.value = eltValue;
	}
	
	addDropDown('sCateg', 'ND');

	let tbody = document.getElementById('idGrid');
	insertTBodyRow(tbody);

	// logger
	let txtMsg = document.getElementById("msg");	// TextArea	
	logger = (msg) => {txtMsg.value += msg + '\r\n'};
}

function applyConstraints(form, name0)
{
	document.getElementById("msg").value = '';	// Logger TextArea
	trigger(form, name0, logger);
}
</script>
</body>
</html>